<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>D·ª± √Ån C·ªßa T√¥i - Tinovideo</title>
  <link rel="stylesheet" href="css/project.css" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>

<body>

  <div class="flex h-screen">
    <!-- Sidebar -->
    <div id="sidebar" class=" w-64 bg-gray-800 border-r border-gray-700 flex flex-col">
      <!-- Logo -->
      <div class="p-6 border-b border-gray-700">
        <div class="flex items-center space-x-3">
          <div
            class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
            <!-- <i class="fas fa-video text-white text-lg"></i> -->
            <img src="./images/logo.png">
          </div>
          <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
            Tinovideo
          </h1>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 py-6">

        <ul class="space-y-2">
          <li>
            <a href="dashboard.html" class="sidebar-item" onclick="showSection('dashboard')">
              <i class="fas fa-chart-pie w-5 mr-3"></i>
              <span data-key="nav-dashboard">Dashboard</span>
            </a>
          </li>
          <li>
            <a href="dashboard.html" class="sidebar-item " onclick="showSection('create')">
              <i class="fas fa-plus-circle w-5 mr-3"></i>
              <span data-key="nav-create">T·∫°o Video M·ªõi</span>
            </a>
          </li>
          <li>
            <a href="projects.html" class="sidebar-item active" onclick="showSection('projects')">
              <i class="fas fa-folder w-5 mr-3"></i>
              <span data-key="nav-projects">D·ª± √Ån C·ªßa T√¥i</span>
            </a>
          </li>
          <li>
            <a href="editvideo.html" class="sidebar-item" onclick="showSection('templates')">
              <i class="fas fa-th-large w-5 mr-3"></i>
              <span data-key="nav-templates">Edit Video</span>
            </a>
          </li>
          <li>
            <a href="affiliate.html" class="sidebar-item" onclick="showSection('affiliate')">
              <i class="fa-brands fa-affiliatetheme w-5 mr-3"></i>
              <span data-key="nav-affiliate">Affiliate</span>
            </a>
          </li>
          <li>
            <a href="settings.html" class="sidebar-item" onclick="showSection('settings')">
              <i class="fas fa-cog w-5 mr-3"></i>
              <span data-key="nav-settings">C√†i ƒê·∫∑t</span>
            </a>
          </li>
          <li>
            <a href="help.html" class="sidebar-item" onclick="showSection('help')">
              <i class="fas fa-question-circle w-5 mr-3"></i>
              <span data-key="nav-help">Tr·ª£ gi√∫p</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- User Info -->
      <div class="p-6 border-t border-gray-700">
        <div class="flex items-center mb-4">
          <div
            class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-3">
            <!-- <span class="text-white font-bold text-sm">DU</span> -->
            <img src="" class="rounded-full" data-key="user-avatar">
          </div>
          <div>
            <div class="font-semibold text-sm" data-key="user-name">Demo Ng∆∞·ªùi d√πng</div>
            <div class="text-xs text-gray-400" data-key="user-plan">Chuy√™n Nghi·ªáp</div>
          </div>
        </div>
        <div class="bg-gray-700 rounded-lg p-3 mb-3">
          <div class="flex justify-between items-center mb-2">
            <span class="text-sm text-gray-300" data-key="credits-remaining">Credits c√≤n l·∫°i:</span>
            <span class="text-lg font-bold text-blue-400" data-key="point">100</span>
          </div>
          <div class="w-full bg-gray-600 rounded-full h-2">
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full" style="width: 70%">
            </div>
          </div>
        </div>
        <button
          class="upgrade-btn w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-2 px-4 rounded-lg text-sm font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300">
          <i class="fas fa-crown mr-2"></i><span data-key="upgrade-btn">N√¢ng c·∫•p</span>
        </button>
      </div>
    </div>
    <div class="flex-1 flex flex-col overflow-hidden">
      <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div class="flex">
          <button id="sidebar-toggle" class="sidebar-toggle hidden-desktop" aria-label="Toggle menu">
            ‚ò∞
          </button>
          <div class="flex items-center space-x-4">
            <h2 class="text-2xl font-bold ml-4 mr-4">D·ª± √Ån C·ªßa T√¥i</h2>
          </div>
          <div class="flex items-center space-x-4">
            <div class="relative steps">
              <!-- <input type="text" placeholder="T√¨m ki·∫øm..."
                class="bg-gray-700 text-white px-4 py-2 pl-10 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none">
              <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i> -->
            </div>
            <button class="p-2 text-gray-400 hover:text-white transition-colors">
              <i class="fas fa-bell text-lg"></i>
            </button>
            <button class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg font-semibold transition-colors">
              <i class="fas fa-plus mr-2 ml-2"></i><span data-key="new-video-btn"></span>
            </button>
          </div>
        </div>
      </header>
      <!-- Main Content -->
      <main class="flex-1 p-6 overflow-y-auto">
        <!-- Header -->

        <div class="projects-header">
          <div>
            <h2>D·ª± √Ån C·ªßa T√¥i</h2>
            <p class="text-gray-400">Qu·∫£n l√Ω t·∫•t c·∫£ c√°c d·ª± √°n video AI c·ªßa b·∫°n</p>
          </div>
          <button class="btn-create">
            <i class="fas fa-plus mr-2 ml-2"></i> T·∫°o D·ª± √Ån M·ªõi
          </button>
        </div>

        <!-- B·ªô l·ªçc -->
        <div class="filter-bar">
          <input type="text" placeholder="üîç T√¨m ki·∫øm d·ª± √°n..." />
          <!-- <select>
          <option>T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option>ƒê√£ xu·∫•t</option>
          <option>ƒêang t·∫°o</option>
          <option>Ch∆∞a b·∫Øt ƒë·∫ßu</option>
        </select>
        <select>
          <option>C·∫≠p nh·∫≠t m·ªõi nh·∫•t</option>
          <option>C≈© nh·∫•t</option>
          <option>A-Z</option>
        </select> -->
          <button class="bg-gray-700 text-white p-2 rounded-lg">
            <i class="fas fa-th"></i>
          </button>
        </div>

        <!-- Khi ch∆∞a c√≥ d·ª± √°n -->
        <div class="project-empty">
          <i class="fas fa-video"></i>
          <h3>Ch∆∞a c√≥ d·ª± √°n n√†o</h3>
          <p>B·∫Øt ƒë·∫ßu t·∫°o d·ª± √°n video AI ƒë·∫ßu ti√™n c·ªßa b·∫°n</p>
          <button class="btn-start">
            <i class="fas fa-plus mr-2 ml-2"></i> T·∫°o D·ª± √Ån ƒê·∫ßu Ti√™n
          </button>
        </div>
      </main>
    </div>

  </div>
  <script>
    let cachedUser = null;
    const API_BASE_URL = 'https://admin.tinovideo.com';
    function fillDataUser(user) {
      const nameDiv = document.querySelector('[data-key="user-name"]');
      if (nameDiv) nameDiv.textContent = user.name;

      const point = document.querySelector('[data-key="point"]');
      if (point) point.textContent = user.point;

      const avatarImg = document.querySelector('[data-key="user-avatar"]');
      if (avatarImg) avatarImg.src = user.avatar;

      const userPlan = document.querySelector('[data-key="user-plan"]');
      // if (userPlan) userPlan.textContent = user.plan || "Ch∆∞a c√≥ g√≥i";
      const claimedPlans = [
        user.free_claimed && "Free",
        user.standard_claimed && "Standard",
        user.pro_claimed && "Pro",
        user.max_claimed && "Max"
      ].filter(Boolean);

      let highestPlan = "Ch∆∞a c√≥ g√≥i";
      const PLAN_PRIORITY = ["Max", "Pro", "Standard", "Free"];
      for (const plan of PLAN_PRIORITY) {
        if (claimedPlans.includes(plan)) {
          highestPlan = plan;
          break;
        }
      }

      if (userPlan) userPlan.textContent = highestPlan;
      const userMoney = document.querySelector('[data-key="user-money"]');
      if (userMoney) if (!user.money) {
        userMoney.textContent = "Ch∆∞a c√≥ hoa h·ªìng";
      } else {
        userMoney.textContent = user.money + ".000 VNƒê";
      }
      const userShare = document.querySelector('[data-key="user-share"]');
      if (userShare) userShare.textContent = user.user_share + " Ng∆∞·ªùi" || "Ch∆∞a c√≥ ng∆∞·ªùi gi·ªõi thi·ªáu ";
      // console.log("‚úÖ User ƒë√£ fill:", user);
    }

    async function getUserInfoOnce() {
      if (cachedUser) return cachedUser;

      const authData = localStorage.getItem("auth_data");
      if (authData) {
        cachedUser = JSON.parse(authData);
        fillDataUser(cachedUser);  // ‚úÖ g·ªçi ƒë√∫ng
        return cachedUser;
      }

      const token = localStorage.getItem("jwt");
      if (!token) return null;

      try {
        const res = await fetch(`${API_BASE_URL}/api/user`, {
          method: "GET",
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        if (data.success) {
          cachedUser = data.user;
          localStorage.setItem("auth_data", JSON.stringify(data.user));
          fillDataUser(cachedUser);  // ‚úÖ truy·ªÅn ƒë√∫ng user
          return cachedUser;
        } else {
          console.warn("‚ùå Kh√¥ng l·∫•y ƒë∆∞·ª£c th√¥ng tin user:", data.error);
          return null;
        }
      } catch (err) {
        console.error("‚ùå L·ªói k·∫øt n·ªëi:", err);
        return null;
      }
    } window.addEventListener("DOMContentLoaded", async () => {
      const user = await getUserInfoOnce();
      if (user) {
        // Sau khi fill xong th√¨ l∆∞u userId ƒë·ªÉ chia s·∫ª link
        localStorage.setItem("userId", user.id);
      }
    });
    const btn = document.getElementById("sidebar-toggle");
    const sidebar = document.getElementById("sidebar");
 const token = localStorage.getItem('jwt');
    if (!token) {
        window.location.href = "index.html";
    } else {
        // G·ª≠i request x√°c th·ª±c token
        fetch(`${API_BASE_URL}/api/user`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
            .then(res => res.json())
            .then(data => {
                if (!data.success) {
                    // ‚ùå Token kh√¥ng h·ª£p l·ªá ‚Üí x√≥a v√† v·ªÅ trang login
                    localStorage.removeItem('jwt');
                    localStorage.removeItem('auth_data');
                    window.location.href = "index.html";
                } else {
                    // ‚úÖ Token h·ª£p l·ªá ‚Üí ti·∫øp t·ª•c
                    fillDataUser(data.user);
                }
            })
            .catch(err => {
                console.error("L·ªói x√°c th·ª±c token:", err);
                localStorage.removeItem('jwt');
                localStorage.removeItem('auth_data');
                window.location.href = "index.html";
            });
    }
    btn.addEventListener("click", () => {
        if (sidebar.style.display === "none") {
            sidebar.style.display = "block"; // Ho·∫∑c "flex", t√πy b·∫°n mu·ªën hi·ªán nh∆∞ th·∫ø n√†o
        } else {
            sidebar.style.display = "none";
        }
    });
  </script>
</body>

</html>